!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RealTimeStats=t():e.RealTimeStats=t()}(self,(()=>(()=>{var e={187:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}(e,r,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,s,c;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=l(e))>0&&s.length>r&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=u.bind(i);return r.listener=n,i.wrapFn=r,r}function p(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):v(r,r.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function y(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var c=l.length,u=v(l,c);for(n=0;n<c;++n)i(u[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,f(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,f(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,i,r,o,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},o.prototype.listenerCount=h,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},43:function(e,t,n){var i,r;!function(o,s){"use strict";i=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&n?o:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):e)}function a(t,n){for(var r=0;r<i.length;r++){var o=i[r];this[o]=r<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function l(e,n,i){return function(){typeof console!==t&&(a.call(this,n,i),this[e].apply(this,arguments))}}function c(e,t,n){return s(e)||l.apply(this,arguments)}function u(e,n,r){var o,s=this;n=null==n?"WARN":n;var l="loglevel";function u(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+n+";"}catch(e){}}}function f(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(l)+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}function p(){if(typeof window!==t&&l){try{return void window.localStorage.removeItem(l)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}"string"==typeof e?l+=":"+e:"symbol"==typeof e&&(l=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=r||c,s.getLevel=function(){return o},s.setLevel=function(n,i){if("string"==typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(o=n,!1!==i&&u(n),a.call(s,n,e),typeof console===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){n=e,f()||s.setLevel(e,!1)},s.resetLevel=function(){s.setLevel(n,!1),p()},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var h=f();null==h&&(h=n),s.setLevel(h,!1)}var f=new u,p={};f.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new u(e,f.getLevel(),f.methodFactory)),t};var h=typeof window!==t?window.log:void 0;return f.noConflict=function(){return typeof window!==t&&window.log===f&&(window.log=h),f},f.getLoggers=function(){return p},f.default=f,f},void 0===(r="function"==typeof i?i.call(t,n,t,e):i)||(e.exports=r)}()},361:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoNetworkQualityStats=void 0;const i=n(43),r=n(436),o=n(187);var s;!function(e){e[e.PAUSED=0]="PAUSED",e[e.EFFECT_APPLIED=1]="EFFECT_APPLIED",e[e.INPUT_FORWARDING=2]="INPUT_FORWARDING"}(s||(s={}));class a extends o.EventEmitter{constructor(e){super(),this.prevTimeStamp={},this.simulcastLayers=[],this.prevPacketsSent={},this._publisher=null,this._statsInterval=e.intervalStats,this._interval=null,this.isQualityLimitated=!1,this.wasQualityLimited=!1}setPublisher(e){this._publisher=e}checkIfQualityLimited(e){e[0].rtcStatsReport.forEach((e=>{if("outbound-rtp"===e.type&&"video"===e.kind){if(this.prevTimeStamp[e.ssrc]&&this.prevPacketsSent[e.ssrc]){const t=e.timestamp-this.prevTimeStamp[e.ssrc],n=8*(e.bytesSent-this.prevPacketsSent[e.ssrc])/t,i={width:e.frameWidth,height:e.frameHeight,framesPerSecond:e.framesPerSecond,qualityLimitationReason:e.qualityLimitationReason,id:e.ssrc,bytes:n,packetsDiff:e.packetsSent-this.prevPacketsSent[e.ssrc]};this.simulcastLayers=[...this.simulcastLayers,i],this.simulcastLayers.forEach((e=>{console.log("none"!=e.qualityLimitationReason),"none"===e.qualityLimitationReason||!1!==this.isQualityLimitated||this.wasQualityLimited?this.wasQualityLimited&&"none"===e.qualityLimitationReason&&this.isQualityLimitated&&(this.isQualityLimitated=!1,this.emit("qualityLimitatedStopped","qualityLimitedStopped")):(this.isQualityLimitated=!0,this.emit("qualityLimitated","qualityLimited"))}))}this.prevPacketsSent[e.ssrc]=e.packetsSent,this.prevTimeStamp[e.ssrc]=e.timestamp,this.wasQualityLimited=this.isQualityLimitated}}))}async attachEvents(){}startStats(){setInterval((async()=>{this.simulcastLayers=[];const e=await(0,r.getRtcStats)(this._publisher);return this.checkIfQualityLimited(e),e}),this._statsInterval)}stopStats(){clearInterval(this._interval),this._interval=null}async getCypher(){return new Promise((async(e,t)=>{(await(0,r.getRtcStats)(this._publisher))[0].rtcStatsReport.forEach((t=>{"transport"===t.type&&(console.log(t.srtpCipher),e(t.srtpCipher))}))}))}async getConnectionType(){return new Promise((async(e,t)=>{(await(0,r.getRtcStats)(this._publisher))[0].rtcStatsReport.forEach((t=>{"local-candidate"===t.type&&("relay"===t.candidateType?e(`TURN ${t.relayProtocol}`):e(t.protocol))}))}))}pauseStreamProcessing(e){console.log("ss")}setOutputState(e){}destroy(){i.default.debug("destroy")}}t.VideoNetworkQualityStats=a},436:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSrtpCipher=t.getRtcStats=t.logPublisher=void 0,t.logPublisher=function(e){console.log(e)},t.getRtcStats=async function(e){return new Promise((async(t,n)=>{try{t(await e.getRtcStatsReport())}catch(e){n(e)}}))},t.getSrtpCipher=async function(e){return new Promise((async(t,n)=>{e[0].rtcStatsReport.forEach((e=>{"transport"===e.type&&(console.log(e.srtpCipher),t(e.srtpCipher))}))}))}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}var i={};return(()=>{"use strict";var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.getRtcStats=e.logPublisher=void 0;const t=n(43),r=n(436);Object.defineProperty(e,"logPublisher",{enumerable:!0,get:function(){return r.logPublisher}}),Object.defineProperty(e,"getRtcStats",{enumerable:!0,get:function(){return r.getRtcStats}});const o=n(361);window.OT=window.OT||{},t.default.setLevel("WARN"),window.OT.RealTimeStats={logPublisher:r.logPublisher,getRtcStats:r.getRtcStats,VideoNetworkQualityStats:o.VideoNetworkQualityStats}})(),i})()));
//# sourceMappingURL=vonage-real-time-stats.js.map